import { HttpError } from '../helpers/HttpError.js';
import { catchAsync } from '../helpers/catchAsync.js';
import {
  createContactSchema,
  updateContactSchema,
} from '../schemas/contactsSchemas.js';
// import {
// createUserDataValidator,
// updateUserDataValidator,
// } from '../utils/userValidators.js';
// import { userService } from '../services/index.js';
import contactsServices from '../services/contactsServices.js';

// export const checkUpdateUserData = catchAsync(async (req, res, next) => {
// if (!Object.keys(req.body).length)
// throw new HttpError(400, 'Invalid user data..');

// const { value, error } = updateUserDataValidator(req.body);

// if (error) throw new HttpError(400, 'Invalid user data..', error);

// await userService.checkUserExists({
// email: value.email,
// _id: { $ne: req.params.id },
// });

// req.body = value;

// next();
// });

export const checkUserId = catchAsync(async (req, res, next) => {
  await contactsServices.checkUserId(req.params.id);
  next();
});

export const checkCreateUserData = catchAsync(async (req, res, next) => {
  const { value, error } = createContactSchema.validate(req.body);

  if (error) throw new HttpError(400, error.message);

  await contactsServices.checkUserExists({
    $or: [{ email: value.email }, { phone: value.phone }],
  });

  req.body = value;

  next();
});
